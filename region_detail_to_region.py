# Given the extensive dataset, let's assume it has been loaded into a DataFrame named `df` from a CSV file.
# Now, we will perform the data reorganization and aggregation as required.

# Assuming the CSV file has been loaded into `df`
# Here is a simplified version of the process, starting from loading the CSV.

import pandas as pd
from io import StringIO

# Mocking up the CSV loading process, replace the StringIO part with `pd.read_csv('your_file_path.csv')`
data = """년도,분기,학년,구,점수
2022,1,1,강남,85.2
2022,1,2,강남,78.8
2022,1,3,강남,74.2
2022,1,4,강남,72.6
2022,1,5,강남,76.3
2022,1,6,강남,76.5
2022,1,7,강남,70.2
2022,1,8,강남,70
2022,1,9,강남,80
2022,1,1,강북,78
2022,1,2,강북,77.1
2022,1,3,강북,76.2
2022,1,4,강북,73
2022,1,5,강북,72.4
2022,1,6,강북,72.6
2022,1,7,강북,65.1
2022,1,8,강북,62
2022,1,9,강북,67
2022,1,1,관악,81.3
2022,1,2,관악,72.9
2022,1,3,관악,77.3
2022,1,4,관악,70.8
2022,1,5,관악,74.6
2022,1,6,관악,75.9
2022,1,7,관악,69.2
2022,1,8,관악,64
2022,1,9,관악,68
2022,1,1,도봉,83.1
2022,1,2,도봉,75.9
2022,1,3,도봉,69.3
2022,1,4,도봉,69.5
2022,1,5,도봉,74.7
2022,1,6,도봉,75.5
2022,1,7,도봉,52
2022,1,8,도봉,72
2022,1,9,도봉,56
2022,1,1,마포,83.7
2022,1,2,마포,75.2
2022,1,3,마포,74.9
2022,1,4,마포,73.3
2022,1,5,마포,73
2022,1,6,마포,74.9
2022,1,7,마포,66.1
2022,1,8,마포,68
2022,1,9,마포,-
2022,1,1,성동,86.5
2022,1,2,성동,75.6
2022,1,3,성동,74.7
2022,1,4,성동,73.6
2022,1,5,성동,75.6
2022,1,6,성동,77.9
2022,1,7,성동,45.3
2022,1,8,성동,49
2022,1,9,성동,60.3
2022,1,1,송파,85.9
2022,1,2,송파,75.6
2022,1,3,송파,73.8
2022,1,4,송파,73.5
2022,1,5,송파,75.8
2022,1,6,송파,78.4
2022,1,7,송파,68.9
2022,1,8,송파,78
2022,1,9,송파,80
2022,1,1,양천,81.7
2022,1,2,양천,75.3
2022,1,3,양천,72.8
2022,1,4,양천,69.3
2022,1,5,양천,74.1
2022,1,6,양천,76.1
2022,1,7,양천,63.1
2022,1,8,양천,72
2022,1,9,양천,-
2022,1,1,은평,83.3
2022,1,2,은평,76.1
2022,1,3,은평,71.8
2022,1,4,은평,70.3
2022,1,5,은평,75.1
2022,1,6,은평,75.9
2022,1,7,은평,65
2022,1,8,은평,66.9
2022,1,9,은평,71.2
2022,1,1,종로,84.4
2022,1,2,종로,71.7
2022,1,3,종로,75.6
2022,1,4,종로,71.3
2022,1,5,종로,76.2
2022,1,6,종로,77.4
2022,1,7,종로,64
2022,1,8,종로,63.9
2022,1,9,종로,-
2022,1,1,중구,87.6
2022,1,2,중구,80
2022,1,3,중구,71.3
2022,1,4,중구,73.7
2022,1,5,중구,71.2
2022,1,6,중구,74
2022,1,7,중구,60
2022,1,8,중구,63.9
2022,1,9,중구,-
2022,1,1,노원,82.8
2022,1,2,노원,77.2
2022,1,3,노원,73.7
2022,1,4,노원,71.5
2022,1,5,노원,76.1
2022,1,6,노원,76.3
2022,1,7,노원,61.6
2022,1,8,노원,73.3
2022,1,9,노원,57.6
2022,1,1,중랑,83.2
2022,1,2,중랑,80.4
2022,1,3,중랑,73.3
2022,1,4,중랑,71.7
2022,1,5,중랑,74.4
2022,1,6,중랑,76
2022,1,7,중랑,71.1
2022,1,8,중랑,58
2022,1,9,중랑,64
2022,1,1,동대문,84.9
2022,1,2,동대문,76.7
2022,1,3,동대문,74.1
2022,1,4,동대문,73.1
2022,1,5,동대문,73.7
2022,1,6,동대문,74.5
2022,1,7,동대문,56.6
2022,1,8,동대문,64
2022,1,9,동대문,68
2022,1,1,성북,84.8
2022,1,2,성북,76.3
2022,1,3,성북,71.7
2022,1,4,성북,71.5
2022,1,5,성북,75.7
2022,1,6,성북,76.9
2022,1,7,성북,68
2022,1,8,성북,70
2022,1,9,성북,-
2022,1,1,서대문,85.4
2022,1,2,서대문,79.4
2022,1,3,서대문,73
2022,1,4,서대문,71.5
2022,1,5,서대문,72.2
2022,1,6,서대문,74.6
2022,1,7,서대문,62.5
2022,1,8,서대문,67
2022,1,9,서대문,65
2022,1,1,용산,83.1
2022,1,2,용산,77.3
2022,1,3,용산,73.6
2022,1,4,용산,72.3
2022,1,5,용산,76.4
2022,1,6,용산,77
2022,1,7,용산,70.5
2022,1,8,용산,63.9
2022,1,9,용산,72
2022,1,1,광진,84.6
2022,1,2,광진,80.4
2022,1,3,광진,70
2022,1,4,광진,68.1
2022,1,5,광진,71.9
2022,1,6,광진,73
2022,1,7,광진,61.1
2022,1,8,광진,84
2022,1,9,광진,60.3
2022,1,1,강동,85.1
2022,1,2,강동,79.3
2022,1,3,강동,73.2
2022,1,4,강동,72.3
2022,1,5,강동,75.6
2022,1,6,강동,76.3
2022,1,7,강동,66.3
2022,1,8,강동,32
2022,1,9,강동,-
2022,1,1,서초,88.3
2022,1,2,서초,80
2022,1,3,서초,76.1
2022,1,4,서초,71.4
2022,1,5,서초,76.7
2022,1,6,서초,75.7
2022,1,7,서초,70.6
2022,1,8,서초,68.7
2022,1,9,서초,68
2022,1,1,동작,84.9
2022,1,2,동작,76.5
2022,1,3,동작,73.4
2022,1,4,동작,71.5
2022,1,5,동작,77
2022,1,6,동작,76.2
2022,1,7,동작,64
2022,1,8,동작,-
2022,1,9,동작,-
2022,1,1,영등포,77.5
2022,1,2,영등포,73.4
2022,1,3,영등포,70.6
2022,1,4,영등포,71.5
2022,1,5,영등포,74.7
2022,1,6,영등포,78.3
2022,1,7,영등포,63.6
2022,1,8,영등포,73.3
2022,1,9,영등포,72
2022,1,1,강서,86.2
2022,1,2,강서,77.6
2022,1,3,강서,72.8
2022,1,4,강서,71.1
2022,1,5,강서,75.3
2022,1,6,강서,74.6
2022,1,7,강서,69.6
2022,1,8,강서,65.8
2022,1,9,강서,73.3
2022,1,1,구로,84.3
2022,1,2,구로,76
2022,1,3,구로,74.3
2022,1,4,구로,74.1
2022,1,5,구로,73.4
2022,1,6,구로,74.7
2022,1,7,구로,61.8
2022,1,8,구로,72
2022,1,9,구로,-
2022,1,1,금천,86.7
2022,1,2,금천,73.6
2022,1,3,금천,77.7
2022,1,4,금천,72.8
2022,1,5,금천,69.1
2022,1,6,금천,75.2
2022,1,7,금천,62.5
2022,1,8,금천,66
2022,1,9,금천,-"""

# Simulating reading a CSV file
df = pd.read_csv(StringIO(data))

# Replace '-' in '점수' with NaN and convert to float
df['점수'] = pd.to_numeric(df['점수'], errors='coerce')

# Define region mappings
region_mapping = {
    '강남': '강남서초', '서초': '강남서초',
    '강동': '강동송파', '송파': '강동송파',
    '강서': '강서양천', '양천': '강서양천',
    '영등포': '서울남부', '구로': '서울남부', '금천': '서울남부',
    '동대문': '서울동부', '중랑': '서울동부',
    '도봉': '서울북부', '노원': '서울북부',
    '서대문': '서울서부', '마포': '서울서부', '은평': '서울서부',
    '종로': '서울중부', '중구': '서울중부', '용산': '서울중부',
    '동작': '동작관악', '관악': '동작관악',
    '성동': '성동광진', '광진': '성동광진',
    '성북': '성북강북', '강북': '성북강북',
    # Continue for all mappings...
}

# Map '구' to '권역'
df['권역'] = df['구'].map(region_mapping)

# Drop rows where '점수' is NaN
df.dropna(subset=['점수'], inplace=True)

학년별_평균 = df.groupby('학년')['점수'].transform('mean')

df['점수'] = df['점수'].fillna(학년별_평균)

# Calculate average score by year, quarter, grade, and region
result = df.groupby(['년도', '분기', '학년', '권역'])['점수'].mean().reset_index()
result['점수'] = result['점수'].round(1)

# Now, save this result to a new CSV file
file_path = './average_scores_by_region_and_grade.csv'
result.to_csv(file_path, index=False)

file_path
