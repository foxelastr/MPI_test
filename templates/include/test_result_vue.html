<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<script>
  const TestSubmitApp = {
    delimiters: ['[[', ']]'],
    data() {
      return {
        csrfToken: document.querySelector('meta[name="csrf-token"]').getAttribute('content'),
        StudentId: "",
        ExamYearSemester: "",
        ExamGrade: "",
        ExamResults: [],
        AnswerList: [],
        Score: "",
        MathAbility: [],
        PredPercentile_low: "",
        PredPercentile_high: "",
        OX_list: [],
        HighSchoolPredictGrade: "",
        StrongWeakPoint: [],
      };
    },
    created() {
      console.log("created()...");
      this.studentId = location.pathname.split('/')[3];
      console.log("studentId : ", this.studentId);
      // URL의 쿼리 스트링 파싱
      const queryString = location.search;
      const params = new URLSearchParams(queryString);
      
      // 각 파라미터를 Vue 데이터 속성에 할당
      this.ExamYearSemester = params.get('year_semester');
      this.ExamGrade = params.get('test_grade');
      
      console.log("ExamYearSemester: ", this.ExamYearSemester);
      console.log("ExamGrade: ", this.ExamGrade);
 
      this.fetchReportDetail(this.studentId);
    },
    methods: {
        fetchReportDetail(studentId) {
            console.log("fetchReportDetail()...", studentId);
            axios.get(`/api/report/detail/${studentId}?year_semester=${this.ExamYearSemester}&test_grade=${this.ExamGrade}`)
            .then(res => {
                console.log("FETCH REPORTDETAIL GET RES", res);
                this.studentId = res.data.StudentId;
                this.ExamYearSemester = res.data.ExamYearSemester
                this.ExamGrade = res.data.ExamGrade
                this.ExamResults = res.data.ExamResults
                this.AnswerList = res.data.AnswerList
                this.Score = res.data.Score
                this.MathAbility = res.data.MathAbility
                this.PredPercentile_low = (res.data.PredPercentile_low * 100).toFixed(2);
                console.log("PredPercentile low_row : ", res.data.PredPercentile_low)
                console.log("PredPercentile low : ", this.PredPercentile_low)
                this.PredPercentile_high = (res.data.PredPercentile_high * 100).toFixed(2);
                console.log("PredPercentile high : ", this.PredPercentile_high)
                this.OX_list = res.data.OX_list
                this.HighSchoolPredictGrade = res.data.HighSchoolPredictGrade
                this.StrongWeakPoint = res.data.StrongWeakPoint
                })
                .catch(err => {
                console.log("FETCH STUDENTDETAIL GET ERR.RESPONSE", err.response);
                alert(`${err.response.status} ${err.response.statusText}`);
                });
        },
    },
  }
  Vue.createApp(TestSubmitApp).mount('#page-top');
  </script>
  